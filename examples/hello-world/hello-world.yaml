tosca_definitions_version: tosca_2_0

metadata:

  template_name: Khutulun Hello World Example
  template_author: Khutulun

imports:

- namespace: kh
  url: khutulun/profile.yaml

topology_template:

  node_templates:

    frontend:
      type: kh:LoadBalancer
      capabilities:
        connectible:
          properties:
            expose: true
      requirements:
      - connection: web-server

    web-server:
      type: kh:Container
      properties:
        count: 3
      capabilities:
        runnable:
          properties:
            image:
              source: docker.io/nginx:1.21.6
      requirements:
      - connection:
          node: database
          relationship:
            type: kh:IPPort

    database:
      type: kh:Container
      capabilities:
        runnable:
          properties:
            image:
              source: docker.io/postgres:14.2
              create-arguments: [ -e, POSTGRES_PASSWORD=postgres ]
      requirements:
      - storage: directory

    directory:
      type: kh:LocalDirectory
      capabilities:
        storage:
          properties:
            temporary: true

  policies:

    - podman:
        type: kh:Run
        properties:
          runner: podman
        targets:
        - frontend
        - web-server
        - database

    - colocate:
        type: kh:Placement
        properties:
          hints: [ Colocate ]
        targets:
        - frontend
        - web-server
