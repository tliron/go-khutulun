tosca_definitions_version: tosca_2_0

imports:

- capabilities.yaml
- relationships.yaml
- interfaces.yaml

node_types:

  Instantiated:
    description: >-
      Base type for nodes that can have zero or more instances.

      See `Redundancy` policy.
    attributes:
      count:
        type: Count
        default: 0
      instances:
        type: list
        entry_schema: Instance
        #default: [ { name: "hello", host: "here" } ]

  Endpoint:
    derived_from: Instantiated
    properties:
      ingress:
        type: boolean
        default: false
    requirements:
    - connection:
        capability: Connectable
        relationship: Connection

  DelegateEndpoint:
    description: >-
      asd
    derived_from: Endpoint

  # Runnable

  Process:
    derived_from: Instantiated
    interfaces:
      events:
        type: Events
    capabilities:
      runnable:
        type: Process
      connectable: Connectable
    requirements:
    - connection:
        capability: Connectable
        relationship: Connection
    - storage:
        capability: Storage
        relationship: Storage

  Container:
    derived_from: Instantiated
    interfaces:
      events:
        type: Events
    capabilities:
      runnable: Container
      connectable: ContainerConnectable
    requirements:
    - connection:
        capability: Connectable
        relationship: Connection
    - storage:
        capability: Storage
        relationship: Storage

  LoadBalancer:
    derived_from: Container
    capabilities:
      runnable:
        type: Container
        properties:
          image:
            default:
              reference: docker.io/nginx:1.21.6
    # TODO: attach an artifact that sets up loadbalancing

  VirtualMachine:
    derived_from: Instantiated
    interfaces:
      events:
        type: Events
    capabilities:
      runnable: VirtualMachine
      connectable: Connectable
    requirements:
    - connection:
        capability: Connectable
        relationship: Connection
    - storage:
        capability: Storage
        relationship: Storage

  # Storage

  LocalDirectory:
    interfaces:
      events:
        type: Events
    capabilities:
      storage: LocalDirectory
