tosca_definitions_version: tosca_2_0

imports:

- capabilities.yaml
- relationships.yaml
- interfaces.yaml

node_types:

  Instantiated:
    description: >-
      Base type for nodes that can have zero or more instances.

      See `Redundancy` policy.
    attributes:
      count:
        type: Count
        default: 0
      instances:
        type: list
        entry_schema: Instance
        #default: [ { name: "hello" } ]

  Endpoint:
    derived_from: Instantiated
    properties:
      ingress:
        type: boolean
        default: false
    requirements:
    - connection:
        capability: Connectable
        relationship: Connection
        count_range: [ 0, UNBOUNDED ]

  DelegateEndpoint:
    description: >-
      An endpoint that registers a delegate.
    derived_from: Endpoint
    properties:
      name:
        description: >-
          If not specified will use the node template's name.
        type: string
        required: false

  # Activities

  Process:
    derived_from: Instantiated
    interfaces:
      events:
        type: Events
    capabilities:
      activity:
        type: Process
      connectable: Connectable
    requirements:
    - connection:
        capability: Connectable
        relationship: Connection
        count_range: [ 0, UNBOUNDED ]
    - storage:
        capability: Storage
        relationship: Storage
        count_range: [ 0, UNBOUNDED ]

  Container:
    derived_from: Instantiated
    interfaces:
      events:
        type: Events
    capabilities:
      activity: Container
      connectable: ContainerConnectable
    requirements:
    - connection:
        capability: Connectable
        relationship: Connection
        count_range: [ 0, UNBOUNDED ]
    - storage:
        capability: Storage
        relationship: Storage
        count_range: [ 0, UNBOUNDED ]

  LoadBalancer:
    derived_from: Container
    capabilities:
      activity:
        type: Container
        properties:
          image:
            default:
              reference: docker.io/nginx:1.22.0
    # TODO: attach an artifact that sets up loadbalancing

  VirtualMachine:
    derived_from: Instantiated
    interfaces:
      events:
        type: Events
    capabilities:
      activity: VirtualMachine
      connectable: Connectable
    requirements:
    - connection:
        capability: Connectable
        relationship: Connection
        count_range: [ 0, UNBOUNDED ]
    - storage:
        capability: Storage
        relationship: Storage
        count_range: [ 0, UNBOUNDED ]

  # Storage

  LocalDirectory:
    interfaces:
      events:
        type: Events
    capabilities:
      storage: LocalDirectory
